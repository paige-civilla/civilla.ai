import React, { useMemo, useState } from "react";
import { Check } from "lucide-react";

type Billing = "monthly" | "yearly";

type Plan = {
  id: "free" | "core" | "pro" | "premium";
  name: string;
  tagline: string;
  monthlyPrice: number | null; // null for free trial
  yearlyPrice: number | null;  // null for free trial
  badge?: string; // e.g. "Most popular"
  highlights: string[]; // short, skimmable list
  includedFull: string[]; // expanded
  notIncluded?: string[]; // expanded
  ctaLabel: string;
  footnote?: string;
};

type AddOn = {
  title: string;
  priceLine: string;
  description: string;
  bullets: string[];
};

export default function Plans() {
  const [billing, setBilling] = useState<Billing>("monthly");

  const plans: Plan[] = useMemo(
    () => [
      {
        id: "free",
        name: "Free Starter (3-Day Trial)",
        tagline:
          "Try Civilla and see how it organizes a family-law case — without downloads or heavy processing.",
        monthlyPrice: 0,
        yearlyPrice: 0,
        highlights: [
          "1 family law case (view-only)",
          "Pattern analysis (read-only)",
          "Evidence uploads (documents only)",
          "Timeline + case journey (read-only)",
          "Lexi research & education (text + talk-to-text)",
          "Create 1 sample document (no download, large watermark)",
        ],
        includedFull: [
          "1 family law case (view-only, no additional cases)",
          "Pattern analysis (read-only)",
          "Evidence upload (documents only)",
          "Evidence timeline (read-only)",
          "Case journey overview (read-only)",
          "Lexi research & education (text + talk-to-text only)",
          "Plain-language explanations of common family-law terms and what filings generally mean",
          "Create 1 sample document (cannot download; permanent large Civilla watermark)",
          "Kid profiles (basic)",
          "Journaling / notes (not analyzed)",
          "Dark mode & accessibility settings",
        ],
        notIncluded: [
          "No document downloads",
          "No exhibits / exhibit builder",
          "No transcription",
          "No video uploads",
          "No audio uploads (and transcription)",
          "No AI deadline extraction",
          "No reminders",
          "No certificates of service / notices of service",
          "No parenting plan builder",
          "No child support estimator",
          "No co-parent communication tools (CivillaConnect)",
          "No additional storage purchases",
        ],
        ctaLabel: "Start Free Starter",
        footnote:
          "Educational and organizational only. Not legal advice. Free Starter is $0 for 3 days.",
      },

      {
        id: "core",
        name: "civilla core",
        tagline:
          "For one user actively organizing one family-law case — with full tools and downloads.",
        monthlyPrice: 19.99,
        yearlyPrice: 199,
        badge: "Most popular",
        highlights: [
          "1 active family law case",
          "30 GB storage",
          "Interactive timeline + evidence tools",
          "Lexi research with citations",
          "AI deadline extraction (confirm required)",
          "Downloads + service docs (with required acknowledgments)",
        ],
        includedFull: [
          "Everything in Free, plus:",
          "1 active family law case",
          "30 GB storage",
          "Unlimited document uploads (reasonable use enforced internally)",
          "Evidence timeline (fully interactive)",
          "Pattern analysis (full)",
          "Lexi research engine (statutes, case law, court rules) with citations + sources shown",
          "AI document analysis",
          "AI deadline extraction (user confirmation required)",
          "Task & deadline tracking",
          "Reminders (email or text — opt-in per type, confirm before activation)",
          "Document creator (responses, counter-petitions, motions: dismiss/compel/enforce/amend/limine, etc.)",
          "Downloadable documents with mandatory disclaimers + acknowledgment and Civilla educational footnotes",
          "Notices of service + certificates of service",
          "Parenting plan builder",
          "Child support estimator (not a calculator)",
          "Exhibit builder (basic)",
          "Audio uploads + transcription",
          "Large document accommodation (e.g., OFW exports)",
          "Kid profiles with evidence linking",
        ],
        notIncluded: [
          "No co-parent communication (CivillaConnect)",
          "No advanced exhibits",
          "No video uploads",
        ],
        ctaLabel: "Select Core",
        footnote:
          "No refunds on monthly or yearly subscriptions (limited exceptions apply).",
      },

      {
        id: "pro",
        name: "civilla pro",
        tagline:
          "For advanced exhibits, deeper workflows, and priority processing — still education-only.",
        monthlyPrice: 29.99,
        yearlyPrice: 299,
        highlights: [
          "50 GB storage",
          "Advanced exhibits builder",
          "Video uploads",
          "Dual OCR verification (cross-checked)",
          "Narrative + claim mapping tools",
          "Priority processing",
        ],
        includedFull: [
          "Everything in Core, plus:",
          "50 GB storage",
          "Advanced exhibits builder",
          "Video uploads",
          "Dual OCR verification (OpenAI OCR + Google OCR cross-checked)",
          "Advanced pattern reporting (narrative building; timeline → evidence → claim mapping)",
          "Parenting plan “age-up” scenarios",
          "High-conflict case support tools",
          "Mediation & pre-trial preparation workflows",
          "Hearing and trial prep organization",
          "Draft trial binder structure",
          "Evidence tagging by issue, child, and claim",
          "Enhanced Lexi research depth",
          "Priority processing",
        ],
        ctaLabel: "Select Pro",
        footnote: "Educational and organizational only. Not legal advice.",
      },

      {
        id: "premium",
        name: "civilla premium",
        tagline:
          "For complex cases and deeper organization: analytics, discovery tracking, and priority support.",
        monthlyPrice: 49.99,
        yearlyPrice: 499,
        highlights: [
          "100 GB storage",
          "Full exhibits management",
          "Multi-child / multi-issue analytics",
          "Discovery + post-judgment workflows",
          "Advanced reminders + escalation tracking",
          "Priority support + early access",
        ],
        includedFull: [
          "Everything in Pro, plus:",
          "100 GB storage",
          "Advanced narrative reports (court-ready organization, still educational)",
          "Full exhibits management",
          "Multi-child, multi-issue analytics",
          "Advanced reminders & escalation tracking",
          "Complex discovery tracking",
          "Post-judgment workflows (enforcement, modification)",
          "Appeals awareness (education only)",
          "Priority support",
          "Early access to new features",
        ],
        ctaLabel: "Select Premium",
        footnote: "Educational and organizational only. Not legal advice.",
      },
    ],
    []
  );

  const addOns: AddOn[] = useMemo(
    () => [
      {
        title: "Additional Case Slot",
        priceLine: "$9.99/month per additional case",
        description: "Designed for multiple co-parents / multiple cases.",
        bullets: [
          "+30 GB storage per case",
          "Full feature parity with your current plan",
        ],
      },
      {
        title: "Evidence-Only Storage (No Analysis)",
        priceLine: "$4.99/month",
        description:
          "Upload and organize evidence without triggering AI processing costs.",
        bullets: [
          "Evidence uploads",
          "Journaling",
          "Timeline storage",
          "No analysis until upgraded",
          "Once upgraded, initial backlog analysis is included (no retroactive penalty)",
        ],
      },
    ],
    []
  );

  return (
    <main className="min-h-screen bg-[#E7ECE8]">
      <div className="mx-auto w-full max-w-6xl px-4 pb-16 pt-10 md:px-6">
        {/* TOP HERO (magazine-like) */}
        <section className="rounded-[28px] border border-neutral-900/15 bg-[#EEF2EE] p-6 md:p-10">
          <div className="grid grid-cols-1 gap-8 md:grid-cols-12 md:gap-10">
            <div className="md:col-span-7">
              <h1 className="text-4xl font-black tracking-tight text-neutral-900 md:text-6xl">
                Plans &amp; Pricing
              </h1>
              <p className="mt-4 max-w-xl text-base leading-relaxed text-neutral-800 md:text-lg">
                Family law only. Built for self-represented users across U.S.
                jurisdictions — educational and organizational tools, not legal advice.
              </p>

              <div className="mt-6 rounded-2xl border border-neutral-900/10 bg-white/55 p-5">
                <div className="text-sm font-semibold text-neutral-900">
                  Shared principles (all plans)
                </div>
                <ul className="mt-3 space-y-2 text-sm text-neutral-800">
                  {[
                    "Educational and organizational only",
                    "Not a law firm • no legal advice",
                    "Downloads require affirmative acknowledgment + release",
                    "No refunds (narrow exceptions listed below)",
                    "Supports interstate family law cases",
                  ].map((t) => (
                    <li key={t} className="flex gap-2">
                      <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                      <span>{t}</span>
                    </li>
                  ))}
                </ul>
              </div>
            </div>

            <div className="md:col-span-5">
              <div className="rounded-2xl border border-neutral-900/10 bg-white/55 p-5">
                <div className="text-sm font-semibold text-neutral-900">
                  Who these prices are for
                </div>
                <p className="mt-2 text-sm leading-relaxed text-neutral-800">
                  Individual plans are <span className="font-semibold">per user</span>.
                  Organizations and DV shelters are custom pricing.
                </p>
              </div>

              <div className="mt-4 rounded-2xl border border-neutral-900/10 bg-white/55 p-5">
                <div className="text-sm font-semibold text-neutral-900">
                  Billing
                </div>

                {/* Toggle */}
                <div className="mt-3 inline-flex w-full items-center justify-between gap-2 rounded-full border border-neutral-900/15 bg-white/70 p-1">
                  <button
                    type="button"
                    onClick={() => setBilling("monthly")}
                    aria-pressed={billing === "monthly"}
                    className={[
                      "flex-1 rounded-full px-4 py-2 text-sm font-semibold transition",
                      billing === "monthly"
                        ? "bg-neutral-900 text-white"
                        : "text-neutral-900/80 hover:bg-white",
                    ].join(" ")}
                  >
                    Monthly
                  </button>

                  <button
                    type="button"
                    onClick={() => setBilling("yearly")}
                    aria-pressed={billing === "yearly"}
                    className={[
                      "flex-1 rounded-full px-4 py-2 text-sm font-semibold transition",
                      billing === "yearly"
                        ? "bg-neutral-900 text-white"
                        : "text-neutral-900/80 hover:bg-white",
                    ].join(" ")}
                  >
                    Yearly
                  </button>

                  <span className="shrink-0 rounded-full border border-neutral-900/15 bg-white px-3 py-1 text-xs font-semibold text-neutral-900">
                    Save 17%
                  </span>
                </div>

                <p className="mt-3 text-xs text-neutral-700">
                  Yearly is billed upfront. No refunds.
                </p>
              </div>
            </div>
          </div>
        </section>

        {/* PLANS GRID */}
        <section className="mt-10">
          <div className="mb-6">
            <h2 className="text-4xl font-black tracking-tight text-neutral-900">
              Choose what fits
            </h2>
            <p className="mt-2 max-w-2xl text-base text-neutral-800">
              Clear tiers, real feature differences — all education-only.
            </p>
          </div>

          <div className="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4">
            {plans.map((plan) => (
              <PlanCard key={plan.id} plan={plan} billing={billing} />
            ))}
          </div>
        </section>

        {/* ADD-ONS (only once, after plans) */}
        <section className="mt-12 rounded-[28px] border border-neutral-900/15 bg-[#EEF2EE] p-6 md:p-10">
          <h3 className="text-3xl font-black tracking-tight text-neutral-900">
            Add-ons
          </h3>
          <p className="mt-2 text-base text-neutral-800">
            Optional upgrades you can add without changing your base plan.
          </p>

          <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-2">
            {addOns.map((a) => (
              <div
                key={a.title}
                className="rounded-2xl border border-neutral-900/10 bg-white/60 p-6"
              >
                <div className="text-xl font-black text-neutral-900">
                  {a.title}
                </div>
                <div className="mt-2 text-sm font-semibold text-neutral-900/80">
                  {a.priceLine}
                </div>
                <p className="mt-3 text-sm leading-relaxed text-neutral-800">
                  {a.description}
                </p>
                <ul className="mt-4 space-y-2 text-sm text-neutral-800">
                  {a.bullets.map((t) => (
                    <li key={t} className="flex gap-2">
                      <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                      <span>{t}</span>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>

          <p className="mt-6 text-sm text-neutral-700">
            Over-limit processing is handled internally (no automatic overage charges).
          </p>
        </section>

        {/* ORGS HERO (separate) */}
        <section className="mt-12 rounded-[28px] border border-neutral-900/15 bg-[#EEF2EE] p-6 md:p-10">
          <div className="grid grid-cols-1 gap-8 md:grid-cols-12">
            <div className="md:col-span-7">
              <h3 className="text-3xl font-black tracking-tight text-neutral-900">
                Organizations &amp; DV Shelters
              </h3>
              <p className="mt-2 text-base text-neutral-800">
                Custom pricing — contact us.
              </p>

              <div className="mt-5 rounded-2xl border border-neutral-900/10 bg-white/60 p-6">
                <div className="text-sm font-semibold text-neutral-900">For</div>
                <ul className="mt-3 space-y-2 text-sm text-neutral-800">
                  {[
                    "Domestic violence shelters",
                    "Legal aid organizations",
                    "Advocacy groups",
                  ].map((t) => (
                    <li key={t} className="flex gap-2">
                      <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                      <span>{t}</span>
                    </li>
                  ))}
                </ul>

                <div className="mt-6 text-sm font-semibold text-neutral-900">
                  Includes
                </div>
                <ul className="mt-3 space-y-2 text-sm text-neutral-800">
                  {[
                    "Custom onboarding",
                    "Privacy-first configurations",
                    "Non-profit pricing",
                    "Bulk access options",
                  ].map((t) => (
                    <li key={t} className="flex gap-2">
                      <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                      <span>{t}</span>
                    </li>
                  ))}
                </ul>

                <button
                  type="button"
                  className="mt-6 w-full rounded-full bg-[#0F3B2E] px-5 py-3 text-center text-sm font-semibold text-white shadow-sm hover:opacity-95"
                  onClick={() => {
                    // Swap this for your real contact route if needed:
                    window.location.href = "/contact";
                  }}
                >
                  Contact us
                </button>

                <p className="mt-3 text-xs text-neutral-700">
                  We’ll help set up privacy-first configurations and onboarding for your team.
                </p>
              </div>
            </div>

            <div className="md:col-span-5">
              <div className="rounded-2xl border border-neutral-900/10 bg-white/60 p-6">
                <div className="text-sm font-semibold text-neutral-900">
                  Refund policy
                </div>
                <p className="mt-2 text-sm text-neutral-800">
                  No refunds on monthly or yearly subscriptions.
                </p>
                <div className="mt-4 text-sm font-semibold text-neutral-900">
                  Limited exceptions
                </div>
                <ul className="mt-2 space-y-2 text-sm text-neutral-800">
                  {[
                    "Duplicate charge",
                    "Technical failure preventing access for an extended period",
                    "Billing error",
                  ].map((t) => (
                    <li key={t} className="flex gap-2">
                      <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                      <span>{t}</span>
                    </li>
                  ))}
                </ul>
                <p className="mt-4 text-xs text-neutral-700">
                  All exceptions require review.
                </p>
              </div>
            </div>
          </div>
        </section>

        <div className="mt-10 text-center text-xs text-neutral-700">
          Civilla is educational and organizational only. Not legal advice.
        </div>
      </div>
    </main>
  );
}

function PlanCard({ plan, billing }: { plan: Plan; billing: Billing }) {
  const isYearly = billing === "yearly";
  const showYearly = isYearly && plan.yearlyPrice != null && plan.id !== "free";

  const priceMain = (() => {
    if (plan.id === "free") return "$0";
    if (showYearly) return `$${plan.yearlyPrice!.toFixed(0)}`;
    return `$${plan.monthlyPrice!.toFixed(2)}`;
  })();

  const priceSuffix = (() => {
    if (plan.id === "free") return "for 3 days";
    if (showYearly) return "/yr";
    return "/mo";
  })();

  const yearlySub = (() => {
    if (!showYearly) return null;
    const perMonth = (plan.yearlyPrice! / 12).toFixed(2);
    return `$${perMonth}/mo billed yearly`;
  })();

  return (
    <article
      className={[
        "relative flex h-full flex-col rounded-[28px] border bg-[#EEF2EE] p-6",
        "border-neutral-900/15",
        plan.badge ? "ring-1 ring-neutral-900/20" : "",
      ].join(" ")}
    >
      {plan.badge ? (
        <div className="absolute -top-3 left-6 rounded-full bg-neutral-900 px-3 py-1 text-xs font-semibold text-white">
          {plan.badge}
        </div>
      ) : null}

      <div className="text-xl font-black text-neutral-900">{plan.name}</div>
      <p className="mt-2 text-sm leading-relaxed text-neutral-800">{plan.tagline}</p>

      <div className="mt-5 rounded-2xl border border-neutral-900/10 bg-white/60 p-5">
        <div className="flex items-end justify-between gap-3">
          <div className="text-4xl font-black tracking-tight text-neutral-900">
            {priceMain}
            <span className="ml-2 text-sm font-semibold text-neutral-900/80">
              {priceSuffix}
            </span>
          </div>
        </div>

        {yearlySub ? (
          <div className="mt-2 text-xs font-semibold text-neutral-800">
            {yearlySub}
          </div>
        ) : null}

        <div className="mt-4">
          <div className="text-sm font-semibold text-neutral-900">Highlights</div>
          <ul className="mt-3 space-y-2 text-sm text-neutral-800">
            {plan.highlights.slice(0, 6).map((t) => (
              <li key={t} className="flex gap-2">
                <Check className="mt-0.5 h-4 w-4 text-neutral-900/70" />
                <span>{t}</span>
              </li>
            ))}
          </ul>
        </div>

        {/* Expanders (keeps page skimmable) */}
        <div className="mt-4 space-y-2">
          <details className="rounded-2xl border border-neutral-900/10 bg-white/50 p-4">
            <summary className="cursor-pointer text-sm font-semibold text-neutral-900">
              See everything included
            </summary>
            <ul className="mt-3 space-y-2 text-sm text-neutral-800">
              {plan.includedFull.map((t) => (
                <li key={t} className="flex gap-2">
                  <Check className="mt-0.5 h-4 w-4 text-neutral-900/60" />
                  <span>{t}</span>
                </li>
              ))}
            </ul>
          </details>

          {plan.notIncluded?.length ? (
            <details className="rounded-2xl border border-neutral-900/10 bg-white/50 p-4">
              <summary className="cursor-pointer text-sm font-semibold text-neutral-900">
                Not included
              </summary>
              <ul className="mt-3 space-y-2 text-sm text-neutral-800">
                {plan.notIncluded.map((t) => (
                  <li key={t} className="flex gap-2">
                    <span className="mt-0.5 inline-flex h-4 w-4 items-center justify-center rounded-full border border-neutral-900/20 text-[10px] font-bold text-neutral-900/70">
                      —
                    </span>
                    <span>{t}</span>
                  </li>
                ))}
              </ul>
            </details>
          ) : null}
        </div>

        <button
          type="button"
          className="mt-5 w-full rounded-full bg-[#0F3B2E] px-5 py-3 text-center text-sm font-semibold text-white shadow-sm hover:opacity-95"
          onClick={() => {
            // Hook this into your real checkout / upgrade flow.
            // If you already have handlers, swap this out.
            console.log("Selected plan:", plan.id);
          }}
        >
          {plan.ctaLabel}
        </button>

        {plan.footnote ? (
          <p className="mt-3 text-xs text-neutral-700">{plan.footnote}</p>
        ) : null}
      </div>
    </article>
  );
}