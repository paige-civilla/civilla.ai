REPLIT TASK: FULL CLICK + ROUTE + AI AUDIT (Marketing + App)

GOAL
Produce a single artifact: AUDIT_REPORT_FULL_APP.md that includes:
1) Every backend API route (method + path)
2) Every frontend route (path) and where it renders
3) “Button map”: every clickable button/link we audit + PASS/FAIL
4) “AI map”: each AI pipeline start→end with PASS/FAIL and failure reason
5) Automated tests that run this audit (Playwright + node scripts)

DO NOT GUESS. VERIFY BY CLICKING OR BY SCRIPTED REQUESTS.
INCLUDE FILE NAMES + LINE NUMBERS FOR FAILURES.

------------------------------------------------------------
PART A — BACKEND ROUTES INVENTORY (Express)
------------------------------------------------------------
1) Create script: script/auditBackendRoutes.ts
- Import the built express app (same app instance used in server/index.ts).
- Enumerate registered routes (method + path).
- Output JSON to: audit/backend_routes.json
- Also output a readable markdown table section appended to AUDIT_REPORT_FULL_APP.md.

Implementation detail:
- Use app._router.stack traversal (Express internal) to list paths.
- Include nested routers.

------------------------------------------------------------
PART B — FRONTEND ROUTES INVENTORY (React Router)
------------------------------------------------------------
2) Create script: script/auditFrontendRoutes.ts
- Parse client/src/App.tsx (or the router file) to extract route paths.
- Output JSON to: audit/frontend_routes.json
- Append a markdown table to AUDIT_REPORT_FULL_APP.md:
  Path | Component/File

If parsing is hard, do a repo search for "<Route" entries and collect them.

------------------------------------------------------------
PART C — CLICK AUDIT (Marketing + App) WITH PLAYWRIGHT
------------------------------------------------------------
3) Add Playwright if not installed.
4) Create tests:
- tests/marketing-links.spec.ts
- tests/app-nav-and-buttons.spec.ts
- tests/lexi-and-ai-smoke.spec.ts

Marketing audit:
- Visit marketing pages (/, /pricing, /plans, /privacy, /terms, etc. if present)
- Collect all visible <a> links and <button> elements with navigation intent.
- Click each one in a controlled way:
  - If it is external: verify it opens and returns HTTP 200 (or at least not 404)
  - If internal: verify URL changes and page renders (no 404)
- Fail test on:
  - console.error
  - navigation to /404 or “Not found”
  - network 500s during click

App audit:
- Login with TEST_EMAIL/TEST_PASSWORD from Replit secrets.
- If not present, create them as secrets and document in report.
- After login:
  - Verify onboarding completion path (if onboarding required)
  - Open mobile viewport test:
    - Ensure nav dropdown scroll works
    - Ensure page behind can scroll when menu open (independent scroll)
  - Click every nav item:
    Dashboard, Start Here, Timeline, Evidence, Exhibits, Trial Prep, Patterns, Documents, Parenting Plan, Child Support, Account Settings
  - For each page, click primary buttons (at minimum):
    Evidence: Upload open, Open viewer, Run extraction, Run AI analysis, Suggest claims
    Documents: Open creator, Compile from claims, Export
    Patterns: Generate, Export
    Trial Prep: Pin item, Export binder
    Lexi: Open panel, Start conversation, Suggested chip click sends message

Record failures:
- Screenshot on failure
- Save console logs
- Save network logs for failed requests

Output:
- Save Playwright artifacts into /audit/playwright/*
- Append a “Buttons/Links PASS/FAIL table” to AUDIT_REPORT_FULL_APP.md

------------------------------------------------------------
PART D — AI PIPELINE START→END SMOKE AUDIT
------------------------------------------------------------
5) Create script: script/aiSmoke.ts
This must test the FULL flow for each AI area:

A) Lexi
- Call /api/ai/health and confirm ok:true
- Create a Lexi thread (POST /api/lexi/threads)
- Send a message (POST /api/lexi/chat)
- Confirm response contains content + sources (if expected)

B) OCR Extraction
- Create case (POST /api/cases) if allowed
- Upload a tiny fixture image (add fixture under script/fixtures/ocr.png)
- Trigger extraction run endpoint
- Poll extraction status until complete/failed (max timeout)
- Confirm extractedText length > 0 on success

C) AI Analysis
- Trigger ai-analyses/run
- Poll until complete/failed
- Confirm summary/findings exist on success

D) Claims Suggest
- Trigger claims/suggest
- Confirm 3-6 claims created with citations

E) Pattern Analysis
- Call /api/cases/:caseId/pattern-analysis
- Confirm payload has themes/patterns counts

F) Compile Claims Doc
- Call compile-claims endpoint
- Confirm markdown output includes Sources section

If any fail:
- Capture error + endpoint + status code + response body (redact secrets)
- Append to AUDIT_REPORT_FULL_APP.md in “AI Map” section.

------------------------------------------------------------
PART E — FINAL REPORT (SINGLE SOURCE OF TRUTH)
------------------------------------------------------------
6) Generate AUDIT_REPORT_FULL_APP.md with these sections:

1) Environment Status (true/false only)
2) Backend Routes (table)
3) Frontend Routes (table)
4) Button/Link Audit Results (table)
5) AI Pipeline Audit Results (table)
6) Failures + Fix Recommendations (bullets with file/line)
7) Final Verdict: READY FOR TESTING (YES/NO) + blockers

------------------------------------------------------------
PART F — RUN COMMANDS
------------------------------------------------------------
Add npm scripts:
- "audit:routes": runs both route scripts
- "audit:ai": runs aiSmoke
- "audit:ui": runs playwright
- "audit:full": runs all and writes the report

Run:
1) npm run audit:routes
2) npm run audit:ai
3) npm run audit:ui
4) Confirm AUDIT_REPORT_FULL_APP.md is created and fully populated.

DELIVERABLES REQUIRED
- audit/backend_routes.json
- audit/frontend_routes.json
- audit/playwright/* artifacts
- AUDIT_REPORT_FULL_APP.md

DO NOT STOP UNTIL REPORT IS COMPLETE.