REPLIT TASK: Fix “flash correct page → redirects to Your Case” (case redirect loop)

Context
In Civilla, the router is using wouter-style navigation (setLocation(item.href)). The symptom (page flashes then returns to “Your Case”) almost always means there is a global effect that says “if I have an active case, always go to /app/dashboard/:caseId”, and it runs on every route change.

GOAL
Only auto-redirect to “Your Case” when the user is on:
- /app
- /app/dashboard (no caseId)
- OR a case-required route that is missing a caseId
Never redirect when the user is already on a valid page.

DO THIS NOW

1) FIND THE REDIRECT (search commands)
In Replit shell, run:

grep -RIn --exclude-dir=node_modules --exclude-dir=dist --exclude=*.map "Your Case" client/src server || true
grep -RIn --exclude-dir=node_modules --exclude-dir=dist --exclude=*.map "setLocation(.*dashboard" client/src || true
grep -RIn --exclude-dir=node_modules --exclude-dir=dist --exclude=*.map "dashboard/\\$\\{.*case" client/src || true
grep -RIn --exclude-dir=node_modules --exclude-dir=dist --exclude=*.map "navigate\\(|useNavigate\\(|<Redirect|replace\\:" client/src || true
grep -RIn --exclude-dir=node_modules --exclude-dir=dist --exclude=*.map "CaseRedirect|case redirect|defaultCase|activeCaseId|selectedCaseId|lastCaseId" client/src || true

You are looking for:
- a useEffect that calls setLocation(`/app/dashboard/${caseId}`) (or similar)
- a “CaseRedirect” component that runs on mount and pushes to dashboard
- a “fallback route” that catches too much and redirects

2) APPLY THE FIX (modify the redirect effect)
Wherever you find the redirect that sends users to dashboard, change it to this pattern.

If the project uses wouter:
- import { useLocation } from "wouter"
- const [location, setLocation] = useLocation()

Then update the redirect effect to ONLY redirect on safe paths:

=== COPY THIS LOGIC EXACTLY (adapt variable names only) ===

const CASE_REQUIRED_PREFIXES = [
  "/app/dashboard",
  "/app/document-library",
  "/app/evidence",
  "/app/timeline",
  "/app/communications",
  "/app/patterns",
  "/app/disclosures",
  "/app/documents",
  "/app/exhibits",
  "/app/deadlines",
  "/app/tasks",
  "/app/contacts",
  "/app/children",
  "/app/child-support",
  "/app/trial-prep",
  "/app/parenting-plan",
  "/app/case-settings",
];

function pathHasCaseId(pathname: string) {
  // e.g. /app/evidence/<caseId> => has 4 segments: ["", "app", "evidence", "<id>"]
  const parts = pathname.split("?")[0].split("/").filter(Boolean);
  return parts.length >= 3 && parts[2] && parts[2].length > 0; // for /app/<module>/<caseId>
}

function isCaseRequiredRoute(pathname: string) {
  return CASE_REQUIRED_PREFIXES.some((p) => pathname === p || pathname.startsWith(p + "/") || pathname.startsWith(p + "?"));
}

useEffect(() => {
  if (!activeCaseId) return;

  const pathname = location.split("?")[0];

  const isRoot = pathname === "/app";
  const isDashboardNoId = pathname === "/app/dashboard";
  const needsCaseId = isCaseRequiredRoute(pathname) && !pathHasCaseId(pathname);

  // ✅ Only redirect in these 3 situations:
  if (isRoot || isDashboardNoId) {
    setLocation(`/app/dashboard/${activeCaseId}`, { replace: true });
    return;
  }

  if (needsCaseId) {
    // Prefer keeping the user in the module they clicked:
    const base = pathname.replace(/\/$/, "");
    setLocation(`${base}/${activeCaseId}`, { replace: true });
    return;
  }

  // ❌ Do not redirect on valid routes (this is what stops the “flash then snap back” bug)
}, [activeCaseId, location, setLocation]);

IMPORTANT:
- Remove any unconditional logic like: if (activeCaseId) setLocation(`/app/dashboard/${activeCaseId}`)
- That line is the bug.

3) FIX “fallback route” if it exists
If you find a route like:
<Route path="/app/:rest*" component={CaseRedirect} />
or any wildcard that runs BEFORE module routes, move it to the bottom OR restrict it to only “/app” and “/app/dashboard”.

4) VERIFY (manual checklist)
After the change:
- Click Evidence/Timeline/Documents/etc → should stay on the correct page (no bounce).
- Go to /app → should redirect to /app/dashboard/:caseId (correct).
- Go to /app/evidence (missing caseId) → should redirect to /app/evidence/:caseId (or dashboard) consistently.

5) REPORT BACK
Reply with:
- The file(s) where the redirect was found
- The exact lines you changed
- Confirmation that redirect only happens on /app, /app/dashboard, or missing-caseId routes

Do NOT change backend routes for this.